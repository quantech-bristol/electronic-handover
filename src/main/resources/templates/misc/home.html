<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">

<head th:include="fragments/header :: head (title='Home')">
</head>

<body>
    <div th:replace="fragments/header :: header">&nbsp;</div>
    <div id="main">
        <table class="patient-table">
            <tr>
                <td>Patient Information</td>
                <td>
                    Status
                    <!--Filter unwell-->
                    <!--Filter risks-->
                    <div class="dropdown">
                        <div class="drop-btn"><i class="fa fa-filter"></i></div>
                        <div class="drop-content">
                            <table class="dropdown-table">
                                <tr>
                                    <td><input type="checkbox" class="filter-box" name="unwell" id="unwell" value="true"/></td>
                                    <td><label class="filter-label" for="unwell">Unwell</label></td>
                                </tr>
                                <tr th:each="risk,iterStat : ${risks}">
                                    <td><input type="checkbox" class="filter-box" name="risk" th:id="${risk.getId()}" th:value="${risk.getId()}"/></td>
                                    <td><label class="filter-label" th:for="${risk.getId()}" th:text="${risk.getName()}"/></td>
                                </tr>
                                <tr>
                                    <td>Apply</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </td>
                <td>
                    Ward Details
                    <!--Filter ward -->
                    <div class="dropdown">
                        <div class="drop-btn"><i class="fa fa-filter"></i></div>
                        <div class="drop-content">
                            <table class="dropdown-table">
                                <tr th:each="ward,iterStat : ${wards}">
                                    <td><input type="checkbox" class="filter-box" name="ward" th:id="${ward.getId()}" th:value="${ward.getId()}"/></td>
                                    <td><label class="filter-label" th:for="${ward.getId()}" th:text="${ward.getName()}"/></td>
                                </tr>
                                <tr>
                                    <td>Apply</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </td>
                <td>
                    Clinical Details
                </td>
                <td>
                    Jobs
                    <!--Filter category-->
                    <!--Filter pending or incomplete-->
                    <div class="dropdown">
                        <div class="drop-btn"><i class="fa fa-filter"></i></div>
                        <div class="drop-content">
                            <table class="dropdown-table">
                                <tr>
                                    <td><input type="radio" class="filter-box" name="complete" id="complete" value="true"/></td>
                                    <td><label class="filter-label" for="complete">Complete</label></td>
                                </tr>
                                <tr>
                                    <td><input type="radio" class="filter-box" name="complete" id="incomplete" value="false"/></td>
                                    <td><label class="filter-label" for="incomplete">Incomplete</label></td>
                                </tr>
                                <tr th:each="category,iterStat : ${category}">
                                    <td><input class="filter-box" type="checkbox" name="category" th:id="${category.getId()}" th:value="${category.getId()}"/></td>
                                    <td><label class="filter-label" th:for="${category.getId()}" th:text="${category.getName()}"/></td>
                                </tr>
                                <tr>
                                    <td>Apply</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <!--Sort by deadline-->
                    <!--<div class="dropdown">-->
                        <!--<div class="drop-btn"><i class="fa fa-sort"></i></div>-->
                        <!--<div class="drop-content">-->
                            <!--<table class="dropdown-table">-->
                                <!--<tr>-->
                                    <!--<td>Apply</td>-->
                                <!--</tr>-->
                            <!--</table>-->
                        <!--</div>-->
                    <!--</div>-->
                </td>
            </tr>
            <tr th:each="jobContext,iterStat : ${jobContexts}">
                <td>
                    <span th:text="${jobContext.patient.FullName}"/><br/>
                    <span th:text="${jobContext.patient.birthDate}"/><br/>
                    <span th:text="${jobContext.patient.getAge()}"/><br/>
                    <span th:if="${jobContext.patient.hospitalNumber}">Hospital Number:  <span th:text="${jobContext.patient.hospitalNumber}"/><br/></span>
                    <span th:if="${jobContext.patient.nHSNumber}">NHS Number: <span th:text="${jobContext.patient.nHSNumber}"/><br/></span>
                    <a th:href="'/patient/id=' + ${jobContext.patient.id}">View details</a></td>
                <td>
                    <span th:if="${jobContext.getUnwell()}">
                        Unwell<br/>
                    </span>
                    <span th:each="risk,iterStat : ${jobContext.getRisks()}" th:text="${risk.getName()}"/>
                </td>
                <td>
                    <span th:text="${jobContext.getWard().getName()}"/><br/>
                    Bed <span th:text="${jobContext.bed}"/><br/>
                </td>
                <td>
                    <span th:text="${jobContext.clinicalDetails}"/>
                </td>
                <td>
                    <table class="job-table">
                        <tr th:each="job,iterStat : ${jobContext.getJobs()}">
                            <td>
                                <span th:text="${job.getCategory().getName()}"/>
                            </td>
                            <td>
                                <span th:text="${job.getDescription()}"/>
                            </td>
                            <td></td>
                            <td>
                                <form action="#" th:action="'/completeJob'" method="post" style="display: inline-block;">
                                    <input type="hidden" name="job" th:value="${job.id}"/>
                                    <button th:if="${!job.isComplete() and job.getDoctor().getId() == #authentication.getPrincipal().getUserCore().getId()}"
                                            type="submit"
                                            class="custom-button green-outlined">
                                        Complete
                                    </button>
                                </form>
                                <span th:if="${job.isComplete()}" class="completed-job">Completed</span>
                                <!--<i class="fa fa-check"></i>-->
                            </td>
                            <td>
                                <a th:if="${job.getDoctor().getId() == #authentication.getPrincipal().getUserCore().getId() and !job.isComplete()}"
                                   th:href="'/handoverJob?jobId=' + ${job.getId()}"><button type="button" class="custom-button orange-outlined">Handover</button></a>
                                <span th:if="${!job.isComplete() and job.getDoctor().getId() != #authentication.getPrincipal().getUserCore().getId()}" class="pending-job">Pending</span>
                                <!--<i class="fa fa-arrow-right"></i>-->
                            </td>
                            <td>
                                <button type="button" class="custom-button blue-outlined">Edit</button>
                                <!--<button type="button" class="custom-button blue-outlined"><i class="fa fa-pencil"></i></button>-->
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <a th:href="'/createJob?jobContextId='+${jobContext.id}"><button type="button" class="custom-button blue-outlined">Add job</button></a>
                                <!--<button type="button" class="custom-button blue-outlined"><i class="fa fa-plus"></i></button>-->
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>

        <form th:action="'/filterJobContexts'" method="get">
            <div class="dropdown">
                <div class="drop-btn">Filter</div>
                <div class="drop-content">
                   <div>
                        <h4>Filter patients by:</h4>
                   </div>
                    <div>
                        <table><td><input type="checkbox" class="filter-box" name="unwell" id="unwell" value="true"/></td>
                         <td><label class="filter-label" for="unwell">Unwell</label></td></table>
                   </div>
                    <div>
                        <h5>Patient has risk:</h5>
                        <div th:each="risk,iterStat : ${risks}">
                            <table><td><input type="checkbox" class="filter-box" name="risk" th:id="${risk.getId()}" th:value="${risk.getId()}" style="padding: 0;"/></td>
                            <td><label class="filter-label" th:for="${risk.getId()}" th:text="${risk.getName()}"/></td></table>
                        </div>
                    </div>
                    <div>
                        <h5>Patient is in ward:</h5>
                        <div th:each="ward,iterStat : ${wards}">
                            <table><td><input type="checkbox" class="filter-box" name="ward" th:id="${ward.getId()}" th:value="${ward.getId()}" style="padding: 0;"/></td>
                            <td><label class="filter-label" th:for="${ward.getId()}" th:text="${ward.getName()}"/></td></table>
                        </div>
                    </div>
                    <div>
                        <h4>Filter jobs by:</h4>
                    </div>
                    <div>
                        <table><td><input type="radio" class="filter-box" name="complete" id="complete" value="true" style="padding: 0;"/></td>
                        <td><label class="filter-label" for="complete">Complete</label></td></table>
                    </div>
                    <div>
                        <table><td><input type="radio" class="filter-box" name="complete" id="incomplete" value="false" style="padding: 0;"/></td>
                        <td><label class="filter-label" for="incomplete">Incomplete</label></td></table>
                   </div>
                   <div>
                       <h5>Job has category:</h5>
                        <div th:each="category,iterStat : ${category}">
                            <table><td><input class="filter-box" type="checkbox" name="category" th:id="${category.getId()}" th:value="${category.getId()}" style="padding: 0;"/></td>
                            <td><label class="filter-label" th:for="${category.getId()}" th:text="${category.getName()}"/></td></table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="dropdown">
                <div class="drop-btn">
                    Sort
                </div>
                <div class="drop-content">
                    <div>
                        <table><td><input class="filter-box" type="radio" name="sort" id="firstName" value="firstName" style="padding: 0;"/></td>
                        <td><label class="filter-label" for="firstName">Sort by First Name (A-Z)</label></td></table>
                    </div>
                    <div>
                        <table><td><input class="filter-box" type="radio" name="sort" id="lastName" value="lastName" style="padding: 0;"/></td>
                            <td><label class="filter-label" for="lastName">Sort by Last Name (A-Z)</label></td></table>
                    </div>
                </div>
            </div>
            <button type="submit" class="custom-button orange-filled">Apply</button>
        </form>

        <table id="patient-info">
            <tr>
                <td>Patient Details</td>
                <td>Inpatient Details</td>
                <td>Clinical Status and Details</td>
                <td>Jobs</td>
                <td></td>
            </tr>
            <div  th:each="jobContext,iterStat : ${jobContexts}">
                <tr>
                    <td>
                        <div class="patient-details">
                            <div class="patient-detail-row">
                                <span class="patient-detail-title">Name</span>
                                <span class="patient-detail"><a th:href="'/patient/id=' + ${jobContext.patient.id}"><span th:text="${jobContext.patient.FullName}"/></a></span>
                            </div>
                            <div class="patient-detail-row">
                                <span class="patient-detail-title">DoB</span>
                                <span class="patient-detail"><span th:text="${jobContext.patient.birthDate}"/></span>
                                <span class="patient-detail-title">Age</span>
                                <span class="patient-detail" th:text="${jobContext.patient.getAge()}"></span> <!-- function using age -->
                            </div>
                            <div class="patient-detail-row"> <!-- if not null -->
                                <span class="patient-detail-title">Hospital Number</span>
                                <span class="patient-detail"><span th:text="${jobContext.patient.hospitalNumber}"/></span>
                            </div>
                            <div class="patient-detail-row"> <!-- if not null -->
                                <span class="patient-detail-title">NHS Number</span>
                                <span class="patient-detail"><span th:text="${jobContext.patient.nHSNumber}"/></span>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="patient-details">
                            <div class="patient-detail-row">
                                <span class="patient-detail-title">Ward</span>
                                <span class="patient-detail" th:text="${jobContext.getWard().getName()}"></span>
                            </div>
                            <div class="patient-detail-row">
                                <span class="patient-detail-title">Bed</span>
                                <span class="patient-detail" th:text="${jobContext.bed}">7</span>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="patient-details">
                            <div th:if="${jobContext.getUnwell()}" class="patient-detail-row">
                                <span class="patient-detail-title" style="color: #ED8B00;">Unwell</span>
                            </div>
                        </div>
                        <div class="patient-details" th:each="risk,iterStat : ${jobContext.getRisks()}">
                            <div class="patient-detail-row">
                                <span class="patient-detail-title" th:text="${risk.getName()}" style="color: #DA291C;"></span>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="patient-details">
                            <div class="patient-detail-row" th:each="job,iterStat : ${jobContext.getJobs()}">
                                <span class="patient-detail-title" th:text="${job.getCategory().getName()} + ': '"></span>
                                <span class="patient-detail" th:text="${job.getDescription()}"></span>
                            </div>
                            <div class="patient-detail-row">
                                <a th:href="'/createJob?jobContextId='+${jobContext.id}">+ Add new job</a>
                            </div>
                        </div>
                    </td>
                    <td style="width: 13%;">
                        <div class="patient-details">
                            <div class="patient-detail-row" th:each="job,iterStat : ${jobContext.getJobs()}">
                                <form action="#" th:action="'/completeJob'" method="post" style="display: inline-block;">
                                    <input type="hidden" name="job" th:value="${job.id}"/>
                                    <button th:if="${!job.isComplete() and job.getDoctor().getId() == #authentication.getPrincipal().getUserCore().getId()}"
                                            type="submit"
                                            class="custom-button green-outlined"
                                            style="margin-left: 4px;">Complete Job</button>
                                </form>
                                <span th:if="${!job.isComplete() and job.getDoctor().getId() != #authentication.getPrincipal().getUserCore().getId()}" class="pending-job">Pending</span>
                                <span th:if="${job.isComplete()}" class="completed-job">Completed</span>
                                <a th:if="${job.getDoctor().getId() == #authentication.getPrincipal().getUserCore().getId() and !job.isComplete()}"
                                   th:href="'/handoverJob?jobId=' + ${job.getId()}"><button type="button" class="custom-button orange-outlined">Handover</button></a>
                            </div>
                        </div>
                    </td>
                </tr>
                <tr class="line">
                    <td colspan="5"></td>
                </tr>
            </div>
        </table>
        <form th:action="@{/pdf}" method="post" name="jobContexts" th:object="${jobContexts}">
            <button type="submit" style="width: 10vw;">View as PDF</button>
        </form>

    </div>

</body>
</html>